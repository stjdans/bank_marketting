<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>대출 심사 - 초기 모델</title>
  <style>
    :root{--navy:#0b3a5a;--bg:#f5f8fb;--card:#fff;--muted:#6b7280}
    body{margin:0;font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, 'Malgun Gothic', sans-serif;background:var(--bg);color:#102030}
    header{background:var(--navy);color:#fff;padding:18px 24px;font-size:20px;font-weight:700}
    .wrap{max-width:1100px;margin:22px auto;display:grid;grid-template-columns:1fr 420px;gap:20px;padding:0 12px}
    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(16,32,48,0.06)}
    h1,h2{margin:0 0 12px 0;color:var(--navy)}
    form .row{display:flex;align-items:center;margin-bottom:10px}
    label{width:170px;font-weight:600}
    input[type="number"], select{flex:1;padding:8px;border:1px solid #e6eef6;border-radius:6px}
    .radio{display:flex;gap:12px}
    .btn{padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--navy);color:#fff}
    .btn-light{background:#fff;border:1px solid #dbeaf6}
    /* table */
    .list-body{max-height:420px;overflow:auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #f3f7fb;text-align:left;font-size:14px}
    th{position:sticky;top:0;background:#fff}
    .footer-actions{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .progress{height:12px;background:#eef6fb;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#2b86d6,#3ab0ff);transition:width .25s}
    @media (max-width:980px){.wrap{grid-template-columns:1fr} .right{order:2}}
  </style>
</head>
<body>
  <header>대출 심사 관리자 - 초기 모델</header>
  <div class="wrap">
    <div class="card left">
      <h2>심사 정보 입력</h2>
      <form id="form" onsubmit="return false;">
        <div class="row"><label>계좌 잔고</label><input id="balance" type="number" min="0" placeholder="숫자 입력" /></div>
        <div class="row"><label>주택 대출 여부</label>
          <select id="housing"><option value="no">아니오</option><option value="yes">예</option></select>
        </div>
        <div class="row"><label>개인 대출 여부</label>
          <select id="personal"><option value="no">아니오</option><option value="yes">예</option></select>
        </div>
        <div class="row"><label>연락수단</label>
          <div class="radio">
            <label><input type="radio" name="contact" value="home" checked> 집전화</label>
            <label><input type="radio" name="contact" value="mobile"> 핸드폰</label>
          </div>
        </div>
        <div class="row"><label>마지막 연락 일</label><input id="last_day" type="number" min="0" placeholder="숫자 입력" /></div>
        <div class="row"><label>마지막 연락 월</label>
          <select id="last_month">
            <option value="1">1월</option><option value="2">2월</option><option value="3">3월</option>
            <option value="4">4월</option><option value="5">5월</option><option value="6">6월</option>
            <option value="7">7월</option><option value="8">8월</option><option value="9">9월</option>
            <option value="10">10월</option><option value="11">11월</option><option value="12">12월</option>
          </select>
        </div>
        <div class="row"><label>마지막 통화 시간(초)</label><input id="last_call" type="number" min="0" placeholder="숫자 입력" /></div>
        <div class="row"><label>현재 캠페인 연락 횟수</label><input id="cur_contacts" type="number" min="0" /></div>
        <div class="row"><label>이전 캠페인 이후 경과 일수</label><input id="days_prev" type="number" min="0" /></div>
        <div class="row"><label>이전 캠페인 연락 횟수</label><input id="prev_contacts" type="number" min="0" /></div>
        <div class="row"><label>이전 캠페인 결과</label>
          <select id="prev_result"><option value="failure">실패</option><option value="success">성공</option></select>
        </div>

        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:14px">
          <button class="btn btn-primary" id="check">심사 확인</button>
          <div id="scoreDisplay">점수: -</div>
        </div>
      </form>

      <p style="margin-top:12px;color:var(--muted);font-size:13px">이 페이지는 초기(프로토타입) 모델입니다. 서버 연동 전 클라이언트 시뮬레이션으로 동작합니다.</p>
    </div>

    <div class="card right">
      <h2>심사 대상자 목록</h2>
      <div class="list-body">
        <table id="listTable">
          <thead><tr><th>이름</th><th>계좌잔고</th><th>주택</th><th>개인</th><th>연락</th><th>이전결과</th><th>점수</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="footer-actions">
        <div style="display:flex;gap:8px;align-items:center">
          <input id="csvFile" type="file" accept=".csv" />
          <button class="btn btn-light" id="downloadSample">샘플 CSV</button>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary" id="assessAll">전체 대상자 심사</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div style="font-size:13px;color:var(--muted)">진행 상황</div>
        <div class="progress" style="margin-top:6px"><i id="bar"></i></div>
        <div id="progressText" style="margin-top:6px;color:var(--muted);font-size:13px">준비</div>
      </div>
    </div>
  </div>

  <script>
    // 초기 샘플 데이터
    const sample = [
      {name:'김유진',balance:3500000,housing:'no',personal:'no',contact:'mobile',prev:'success',score:null},
      {name:'박사준',balance:1200000,housing:'yes',personal:'no',contact:'home',prev:'failure',score:null},
      {name:'최지훈',balance:9800000,housing:'no',personal:'yes',contact:'mobile',prev:'failure',score:null},
      {name:'조아름',balance:450000,housing:'yes',personal:'yes',contact:'home',prev:'failure',score:null}
    ];

    const tbody = document.querySelector('#listTable tbody');
    const bar = document.getElementById('bar');
    const progressText = document.getElementById('progressText');

    let applicants = sample.slice();
    function render(){
      tbody.innerHTML = '';
      applicants.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.name}</td><td>${a.balance}</td><td>${a.housing}</td><td>${a.personal}</td><td>${a.contact}</td><td>${a.prev}</td><td>${a.score!=null? a.score+'%':'-'}</td>`;
        tbody.appendChild(tr);
      });
    }
    render();

    function computeScore(r){
      let s = 40;
      s += Math.min(30, (Number(r.balance)||0)/10000000*30);
      s += r.housing==='no'? 8 : -6;
      s += r.personal==='no'? 6 : -8;
      s += r.contact==='mobile'?4:-2;
      const lastDay = Number(document.getElementById('last_day').value)||9999;
      if(lastDay<7) s+=6; else if(lastDay<30) s+=3; else s-=4;
      s += (Number(document.getElementById('last_call').value)||0)/60;
      s = Math.round(Math.max(0, Math.min(100, s)));
      return s;
    }

    document.getElementById('check').addEventListener('click', ()=>{
      const rec = {
        balance: document.getElementById('balance').value,
        housing: document.getElementById('housing').value,
        personal: document.getElementById('personal').value,
        contact: document.querySelector('input[name="contact"]:checked').value
      };
      const score = computeScore(rec);
      document.getElementById('scoreDisplay').innerText = '점수: ' + score + '%';
    });

    // CSV 업로드 간단 파싱 (헤더 포함)
    document.getElementById('csvFile').addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        const txt = ev.target.result.trim();
        const lines = txt.split(/\r?\n/).filter(l=>l);
        if(lines.length<2) return alert('CSV가 비었거나 형식이 잘못되었습니다.');
        const header = lines[0].split(',').map(h=>h.trim());
        const rows = lines.slice(1).map(l=>l.split(',').map(c=>c.trim()));
        applicants = rows.map(cols=>{
          const obj = {};
          header.forEach((h,i)=> obj[h]=cols[i]||'');
          return {
            name: obj.name||obj.이름||'이름없음',
            balance: obj.balance||obj.계좌잔고||0,
            housing: (obj.housing_loan||obj.주택대출여부||'no').toLowerCase(),
            personal: (obj.personal_loan||obj.개인대출여부||'no').toLowerCase(),
            contact: (obj.contact_method||obj.연락수단||'mobile').toLowerCase(),
            prev: (obj.prev_campaign_result||obj.이전캠페인결과||'failure').toLowerCase(),
            score: null
          };
        });
        render();
      };
      reader.readAsText(f,'UTF-8');
    });

    // 샘플 CSV 다운로드
    document.getElementById('downloadSample').addEventListener('click', ()=>{
      const header = ['id','name','balance','housing_loan','personal_loan','contact_method','last_contact_day','last_contact_month','last_call_time_sec','current_campaign_contacts','days_since_prev_campaign','prev_campaign_contacts','prev_campaign_result'];
      const rows = [
        ['1','김유진','3500000','no','no','mobile','3','8','180','2','120','1','success'],
        ['2','박사준','1200000','yes','no','home','45','6','60','1','200','2','failure']
      ];
      let csv = header.join(',') + '\n' + rows.map(r=>r.join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'sample_applicants.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // 전체 심사 시뮬레이션
    document.getElementById('assessAll').addEventListener('click', ()=>{
      if(applicants.length===0) return alert('대상자가 없습니다. CSV를 업로드하세요.');
      let i=0; progressText.innerText='심사중...';
      const total = applicants.length;
      const timer = setInterval(()=>{
        applicants[i].score = Math.round(Math.random()*60 + 20); // 임시 랜덤
        render();
        i++;
        bar.style.width = Math.round((i/total)*100) + '%';
        if(i>=total){ clearInterval(timer); progressText.innerText='심사 완료'; }
        else progressText.innerText = i + ' / ' + total + ' 처리중';
      }, 300);
    });
  </script>
</body>
</html>
